query {
  search(
    first: %(max_results)d,
    %(results_offset)s,
    type: REPOSITORY,
    query: "%(search_query)s",
  ) {
    pageInfo {
      endCursor
      hasNextPage
    }
    nodes {
      ... on Repository {
        id
        name
        createdAt
        pushedAt
        primaryLanguage {
          #id
          name
        }
        languages(first:%(max_languages)d) {
          nodes {
            #id
            name
          }
        }
        ...commits
        ...ownerRepositories
        ...repositoryTopics
      }
    }
  }
}

fragment commits on Repository {
  defaultBranchRef {
    target {
      ... on Commit {
        id
        history(first: %(max_commits)d) {
          nodes {
            author {
              user {
                id
                #login
              }
            }
          }
        }
      }
    }
  }
}

fragment ownerRepositories on Repository {
  owner {
    id
    login
    pinnedRepositories(first: %(max_pinned_repositories)d, orderBy: { field: UPDATED_AT, direction: DESC }) {
      ...repositoryConnections
    }
    repositories(first: %(max_repositories)d, orderBy: { field: UPDATED_AT, direction: DESC }) {
      ...repositoryConnections
    }
  }
}

fragment repositoryConnections on RepositoryConnection {
  nodes {
    id
    nameWithOwner
    isFork
    isMirror
    createdAt
    pushedAt
    primaryLanguage {
      #id
      name
    }
    languages(first:%(max_languages)d) {
      nodes {
        #id
        name
      }
    }
    #...commits
    ...repositoryTopics
  }
}

fragment repositoryTopics on Repository {
  repositoryTopics(first: %(max_topics)d) {
    nodes {
      topic {
        #id
        name
      }
    }
  }
}
