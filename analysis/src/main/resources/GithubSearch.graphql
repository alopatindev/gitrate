query {
  search(
    first: ${max_results},
    ${page},
    type: ${type},
    query: "${search_query}",
  ) {
    pageInfo {
      endCursor
      hasNextPage
    }
    nodes {
      ... on Repository {
        id
        name
        createdAt
        pushedAt
        primaryLanguage {
          #id
          name
        }
        languages(first:${max_languages}) {
          nodes {
            #id
            name
          }
        }
        ...commits
        ...ownerRepositories
        ...repositoryTopics
      }
    }
  }
}

fragment commits on Repository {
  defaultBranchRef {
    target {
      ... on Commit {
        oid
        history(first: ${max_commits}) {
          nodes {
            author {
              user {
                id
                #login
              }
            }
          }
        }
      }
    }
  }
}

fragment ownerRepositories on Repository {
  owner {
    id
    login
    pinnedRepositories(first: ${max_pinned_repositories}, orderBy: { field: UPDATED_AT, direction: DESC }) {
      ...repositoryConnections
    }
    repositories(first: ${max_repositories}, orderBy: { field: UPDATED_AT, direction: DESC }) {
      ...repositoryConnections
    }
  }
}

fragment repositoryConnections on RepositoryConnection {
  nodes {
    id
    nameWithOwner
    isFork
    isMirror
    createdAt
    pushedAt
    primaryLanguage {
      #id
      name
    }
    languages(first:${max_languages}) {
      nodes {
        #id
        name
      }
    }
    #...commits
    ...repositoryTopics
  }
}

fragment repositoryTopics on Repository {
  repositoryTopics(first: ${max_topics}) {
    nodes {
      topic {
        #id
        name
      }
    }
  }
}
